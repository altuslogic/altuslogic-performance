<?php if ($show=='search' || $show=='all'){ ?>
<table><tr><td valign="top">
<div class="divNoScroll">                                                       
    <h2>Configuration</h2>
    <div class="divScroll">
    <?php                                                                       
    echo list_config();
    ?>
    </div>
</div>      
</td><td valign="top">  
<div class="divNoScroll">
    <h2>Paramètres de recherche</h2>
    <form action="?stage=update_param" method="post" autocomplete="off">
    <input type="hidden" name="hash" value="<?php echo $hash; ?>">
        <table>
             <tr><td>Position</td><td><select class="grayStyle" id="mode" name="mode">
                        <option <?php if (isset($mode) && $mode=="tout") echo 'selected'; ?> value="tout">tout</option>
                        <option <?php if (isset($mode) && $mode=="debut") echo 'selected'; ?> value="debut">début</option>
                        <option <?php if (!isset($mode) || $mode=="milieu") echo 'selected'; ?> value="milieu">milieu</option>
                        <option <?php if (isset($mode) && $mode=="fin") echo 'selected'; ?> value="fin">fin</option>
                    </select></td></tr>   
            <tr><td>Méthode de recherche</td><td><select class="grayStyle" id="methode" name="methode">
                        <option <?php if (!isset($methode) || $methode=="direct") echo 'selected'; ?> value="direct">directe</option>
                        <?php $array = etatTables($nomColonne);
                        if ($array['tables']){ ?>
                        <option <?php if (!isset($methode) || $methode=="tables") echo 'selected'; ?> value="tables">sous-tables</option>
                        <?php } if ($array['mot']){ ?>
                        <option <?php if (isset($methode) && $methode=="mot") echo 'selected'; ?> value="mot">index(mot)</option>
                        <?php } if ($array['phrase']){ ?>
                        <option <?php if (isset($methode) && $methode=="tout") echo 'selected'; ?> value="tout">index(texte)</option>
                        <?php } ?>
                    </select></td></tr>
            <tr><td>Visuel</td><td><select class="grayStyle" id="visuel" name="visuel">
                        <option <?php if (isset($visuel) && $visuel=="suggest") echo 'selected'; ?> value="suggest">suggestion</option>
                        <option <?php if (!isset($visuel) || $visuel=="result") echo 'selected'; ?> value="result">résultats</option> 
                    </select></td></tr>
            <tr><td>Résumé</td><td><select class="grayStyle" id="resume" name="resume">
                        <option <?php if (!isset($resume) || $resume==1) echo 'selected'; ?> value=1>avec</option>
                        <option <?php if (isset($resume) && $resume==0) echo 'selected'; ?> value=0>sans</option> 
                    </select></td></tr>
            <tr><td>Nombre de résultats</td><td><input type="text" class="grayStyle" id="limite" name="limite" value="<?php echo (isset($limite)?$limite:10); ?>"></td></tr>
            <tr><td>Nom du cadre</td><td><input type="text" class="grayStyle" id="nomDiv" name="nomDiv" value="<?php echo (isset($nomDiv)?$nomDiv:'ajax'); ?>"></td></tr> 
            <tr><td>Affichage du cadre</td><td><select class="grayStyle" id="afficheDiv" name="afficheDiv">
                        <option <?php if (!isset($afficheDiv) || $afficheDiv==1) echo 'selected'; ?> value=1>avec</option>
                        <option <?php if (isset($afficheDiv) && $afficheDiv==0) echo 'selected'; ?> value=0>sans</option> 
                    </select></td></tr>
            <tr><td>Format général</td><td><textarea id="containerAll" name="containerAll" spellcheck="false" style="color: #444; border: 1px solid #444; max-width: 205px;"
            ><?php echo (isset($containerAll)?$containerAll:'<b>~TITLE~</b><ul>~ALL~</ul>~TIME~'); ?></textarea></td></tr>
            <tr><td>Format résultat</td><td><textarea id="containerResult" name="containerResult" spellcheck="false" style="color: #444; border: 1px solid #444; max-width: 205px;"
            ><?php echo (isset($containerResult)?$containerResult:'<li>~RES~</li>'); ?></textarea></td></tr>    
            <tr><td>Format détails</td><td><textarea id="containerDetails" name="containerDetails" spellcheck="false" style="color: #444; border: 1px solid #444; max-width: 205px;"
            ><?php echo (isset($containerDetails)?$containerDetails:'~'.strtoupper($nomColonne).'~'); ?></textarea></td></tr>  
            <tr><td>Description</td><td><textarea id="description" name="description" spellcheck="false" style="color: #444; border: 1px solid #444; max-width: 205px;"
             ><?php echo (isset($description)?$description:''); ?></textarea></td></tr>    
        </table> 
        <p align="center"><input type="submit" name="action" value="new"><input type="submit" name="action" value="save"><input type="submit" name="action" value="delete"></p> 
    </form>
</div> 
</td><td valign="top">  
<div class="divNoScroll">  
    <h2>Recherche</h2>
    <?php
    echo $print_search;
    ?>
</div>
</td><td valign="top">  
<div class="divNoScroll">
    <h2>Code</h2>
    <textarea style="width:inherit; height:145px; resize: none;" readonly="readonly"><?php
        echo $print_search;
        ?></textarea>  
</div>
</td></tr></table> 

<?php }
if ($show=='index' || $show=='all'){ ?>  

<table><tr><td valign="top">
<div class="divNoScroll">
    <h2>Menu action </h2>
    <a href="?stage">Home</a> |
    <a href="?stage=initialize">Initialize</a> <br><br>
    <a href="?stage=performances">Performances</a> <br><br>
    <a href="?stage=details">Details</a><br><br>       
    <a href="?stage=delete_tables">Delete tables</a>  -
    <a href="?stage=delete_index">Delete index</a> -              
    <a href="?stage=clear_cache">Clear cache</a>     
</div>               
</td><td valign="top">                                      
<div class="divNoScroll">
    <h2>Insert / Delete</h2>
    <form action="?stage=modif" method="post" autocomplete="off">
        <input type="text" size=25 name="modif" id="modif" value="<?php if (isset($_POST['modif'])) echo $_POST['modif']; ?>" style="background-color: transparent; color: #444; border: 1px solid #444;">
        <br><br><input type="submit" value="insert" name="action"> 
        <input type="submit" value="delete" name="action">   
    </form>
</div>
</td><td valign="top"> 
<div class="divNoScroll">
    <form method="get" autocomplete="off">
        <h2>Paramètres d'indexation (sous-tables)</h2>
        Threshold (nb items / sous-table)<br><input type="text" size=8 id="threshold" name="threshold" value="<?php echo $thres; ?>" style="background-color: transparent; color: #444; border: 1px solid #444;">
        <br>Ordre d'indexation<br> <input type="text" size=8 name="ordre" id="ordre" value="<?php echo $ordreMax; ?>" style="background-color: transparent; color: #444; border: 1px solid #444;">
        <br><br><input type="submit" value="validate" id="initialize"> 
    </form>
</div>
</td><td valign="top"> 
<div class="divBig">
    <h2>Indexation</h2>
    <?php          
    if ($nomBase && $nomTable) echo info_colonnes();    
    ?>
</div>
</td></tr></table>  

<?php }         
if ($show=='selection' || $show=='all'){ ?>

<table><tr><td valign="top">
<div class="divNoScroll">
    <h2>Sélection de la db</h2> 
    <?php          
    echo list_db();    
    ?>
</div>
</td><td valign="top">
<div class="divNoScroll">
    <h2>Sélection de la table</h2> 
    <?php          
    if ($nomBase) echo list_tables();    
    ?>
</div>
</td><td valign="top">
<div class="divNoScroll">
    <h2>Sélection de la colonne</h2>
    <?php          
    if ($nomBase && $nomTable) echo list_colonnes();    
    ?>
</div>
</td></tr></table> 

<?php }          
if ($show=='keywords' || $show=='all'){
$print = "";
if ($nomBase && $nomTable && $nomColonne) $print = stats(20); ?> 

<center>Requis : index mot</center>
<table><tr><td>
<div class="stats">
    <h2>Top keywords</h2>
        <?php echo $print;?> 
</div>
</td><td valign="top">
<div id="stats_keywords" class="divNoScroll">
    <h2>Keyword</h2>
</div>
</td></tr></table>

<?php }          
if ($show=='expr' || $show=='all'){
$print = "";
$lim = isset($_GET['limit'])? $_GET['limit']: 50;
$seuil1 = isset($_GET['seuil1'])? $_GET['seuil1']: 5;
$seuil2 = isset($_GET['seuil2'])? $_GET['seuil2']: 15;
$seuil3 = isset($_GET['seuil3'])? $_GET['seuil3']: 20;
$seuil4 = isset($_GET['seuil4'])? $_GET['seuil4']: 95;
if ($nomBase && $nomTable && $nomColonne && isset($_GET['limit'])) $print = expressions($lim,array($seuil1,$seuil2,$seuil3,$seuil4));
else $print = "Les seuils globaux correspondent au rapport<br>de fréquences de l'expression et du mot d'origine,
<br>les seuils locaux au rapport de fréquences<br>entre l'expression et son extension.<br>"; ?> 

<center>Requis : index mot, index phrase
<br>Conseillé : sous-tables de l'index phrase</center>
<table><tr><td valign="top">    
<div class="stats">
    <h2>Top expressions</h2>
    <form method="get" autocomplete="off">
    <table><tr><td>Limite : </td><td><input type="text" name="limit" title="nombre de mots examinés" value="<?php echo $lim;?>"></td></tr>
    <tr><td>Seuils (%) : </td><td><input type="text" name="seuil1" value="<?php echo $seuil1;?>" title="seuil global d'affichage" style="width:25px"> 
    <input type="text" name="seuil2" value="<?php echo $seuil2;?>" title="seuil global de proposition" style="width:25px">
    <input type="text" name="seuil3" value="<?php echo $seuil3;?>" title="seuil global d'extension" style="width:25px">
    <input type="text" name="seuil4" value="<?php echo $seuil4;?>" title="seuil local d'affichage" style="width:25px"><input type="submit" value="ok"></td></tr></table> 
    </form>
    <?php if ($print!=""){ ?>
    <form action="correction_ops.php?stage=expression" method="post" target="iframe_expr">  
    <br><div style="max-height:500px; overflow:auto; border:1px solid #aaa;"><br><?php echo $print;?><br></div>
    <p align="center"><input type="submit" name="action" value="add"></p>  
    </form>
    <?php } ?>  
</div> 
</td><td valign="top">
<div id="stats_expr" class="divNoScroll">
    <h2>Expression</h2>
</div>
<iframe class="divNoScroll" name="iframe_expr"></iframe>
</td></tr></table>

<?php }          
if ($show=='errors' || $show=='all'){
$print = "";
$meth = isset($_GET['methode'])? $_GET['methode']: "word";
$lim = isset($_GET['limit'])? $_GET['limit']: 50;  
$seuil = isset($_GET['seuil'])? $_GET['seuil']: 75;  
if ($nomBase && $nomTable && $nomColonne && isset($_GET['limit'])) $print = corrections($meth,$lim,$seuil/100); ?> 

<center>Requis : index mot ou index phrase</center>
<table><tr><td valign="top">    
<div class="stats">
    <h2>Top errors</h2>
    <form method="get" autocomplete="off">
    Indexation : <input type="radio" name="methode" value="word" <?php if ($meth=='word') echo 'checked'; ?>>mot
    <input type="radio" name="methode" value="phrase" <?php if ($meth=='phrase') echo 'checked'; ?>>phrase
    <br><br><table><tr><td>Limite : </td><td><input type="text" name="limit" title="nombre de mots examinés" value="<?php echo $lim;?>"></td></tr>
    <tr><td>Seuil (%) : </td><td><input type="text" name="seuil" title="seuil de similarité" value="<?php echo $seuil;?>"><input type="submit" value="ok"></td></tr></table>
    </form>
    <?php if ($print!=""){ ?> 
    <form action="correction_ops.php?stage=correct" method="post" target="iframe_correc">
    <input type="hidden" name="methode" value=<?php echo $meth; ?>>
    <br><div style="max-height:500px; overflow:auto; border:1px solid #aaa;"><ul><?php echo $print;?></ul></div>
    <p align="center"><input type="submit" name="action" value="correct"><input type="submit" name="action" value="ignore"></p>
    </form>  
    <?php } ?>
</div></td>

<td valign="top">
<div id="stats_correc" class="divNoScroll">
    <h2>Error</h2>
</div>
<iframe class="divNoScroll" name="iframe_correc"></iframe>
</td></tr></table>

<?php }          
if ($show=='correct' || $show=='all'){ ?> 

<table><tr><td valign="top">
<div class="divNoScroll">
    <h2>Projets de correction</h2>
    <form action="?stage=add_project" method="post" autocomplete="off">
    <input type="text" name="projet">
    <input type="submit" value="add">
    </form>
    <form action="?stage=reindex" method="post">
    <input type="hidden" name="global" value="on">
    <?php echo list_projets(); ?>
    <p align="center"><input type="submit" value="apply"></p>
    </form>
</div></td>

<td valign="top">
<div class="stats">
    <h2>Corrections</h2>
    <div class="divScroll">
    <?php echo list_correc(); ?>
    </div>
</div>

</td><td valign="top">
<div class="divNoScroll">
    <h2>Edition</h2>
    <form action="?stage=update_correc" method="post" autocomplete="off">
    <input type="hidden" name="correc_id" value="<?php if (isset($correc_id)) echo $correc_id; ?>">     
    <table><tr><td>Action</td><td><select class="grayStyle" name="correc_action">
    <?php $liste=array('correct','split','merge','ignore','no_index','expression');
    foreach ($liste as $val){
    echo "<option value=$val".((isset($correc_action) && $correc_action==$val)? ' selected' : '').">$val</option>"; 
    } ?>          
    </select></td></tr>
    <tr><td>Type</td><td><select class="grayStyle" name="correc_type">
    <option value="word" <?php if (isset($correc_type) && $correc_type=='word') echo 'selected'; ?>>mot</option>
    <option value="phrase" <?php if (isset($correc_type) && $correc_type=='phrase') echo 'selected'; ?>>phrase</option></select></td></tr>                                                                                                                                                       
    <tr><td>Mot</td><td><textarea class="grayStyle" name="correc_word" spellcheck="false" style="width:200px; max-width:200px;"><?php if (isset($correc_word)) echo decode($correc_word); ?></textarea></td></tr> 
    </table>
    <p align="center"><input type="submit" name="action" value="new">
    <input type="submit" name="action" value="save">
    <input type="submit" name="action" value="delete"></p></form>
</div>
</td></tr></table>

<?php }          
if ($show=='geo' || $show=='all'){ ?> 

<div id="geo">
    <h2>Géo</h2>
    <form method="get" autocomplete="off">
        Latitude<br><input type="text" size=25 name="latitude" id="latitude" style="background-color: transparent; color: #444; border: 1px solid #444;"> 
        <br><br>Longitude<br><input type="text" size=25 name="longitude" id="longitude" style="background-color: transparent; color: #444; border: 1px solid #444;">
        <br><br><input type="button" value="goto" id="goto" onclick="javascript:gotoCoord();"><input type="button" value="reset" id="reset" onclick="javascript:resetCoord();">       
    </form>    
    <div id="map_canvas" style="width:100%; height:100%"></div> 
</div>  

<?php }
if ($show=='log' || $show=='all'){ ?>
<table><tr><td>
<div class="divBig">
    <h2>Log</h2>
    <div class="divScroll">
    <?php          
    echo list_log();    
    ?> 
    </div>                                                                                 
    <form method="post" action="?stage=clear_log">
    <p align="center"><input type="submit" value="clear"></p>
    </form>
</div></td></tr></table>

<?php } ?>